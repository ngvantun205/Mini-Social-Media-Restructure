@model Mini_Social_Media.Models.InputModel.StoryInputModel
@{
    ViewData["Title"] = "Create Story";
    Layout = "_Layout";
}

<div class="container mt-4" style="max-width: 500px;">
    <div class="card border-0 shadow-sm rounded-4">
        <div class="card-header bg-white border-bottom-0 pt-4 text-center">
            <h4 class="fw-bold">Add directly to Story</h4>
        </div>
        
        <div class="card-body">
            <form asp-controller="Story" asp-action="Create" method="post" enctype="multipart/form-data" id="createStoryForm">
                
                <div class="story-upload-area mb-3 rounded-3 d-flex align-items-center justify-content-center bg-light position-relative" 
                     style="height: 450px; border: 2px dashed #dbdbdb; overflow: hidden; cursor: pointer;"
                     onclick="document.getElementById('StoryMedia').click()">
                    
                    <div id="uploadPlaceholder" class="text-center text-muted">
                        <i class="fas fa-images display-4 mb-2"></i>
                        <p class="mb-0 fw-bold">Click to select photo or video</p>
                        <small>Support JPG, PNG, MP4</small>
                    </div>

                    <img id="imagePreview" src="" style="display: none; width: 100%; height: 100%; object-fit: contain;">
                    <video id="videoPreview" src="" style="display: none; width: 100%; height: 100%; object-fit: contain;" controls></video>
                </div>

                <input asp-for="StoryMedia" type="file" accept="image/*,video/*" class="d-none" onchange="previewFile(this)">

                <div class="form-floating mb-4">
                    <textarea asp-for="Caption" class="form-control" placeholder="Add a caption" style="height: 100px; resize: none; border-radius: 12px;"></textarea>
                    <label asp-for="Caption">Add a caption (Optional)</label>
                </div>

                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary rounded-pill py-2 fw-bold" id="btnSubmit">
                        Share to Story
                    </button>
                    <a asp-controller="Home" asp-action="Index" class="btn btn-light rounded-pill py-2 fw-bold text-muted">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function previewFile(input) {
            const file = input.files[0];
            if (!file) return;

            const placeholder = document.getElementById('uploadPlaceholder');
            const imgPreview = document.getElementById('imagePreview');
            const videoPreview = document.getElementById('videoPreview');

            // Ẩn placeholder
            placeholder.style.display = 'none';

            // Reset preview
            imgPreview.style.display = 'none';
            videoPreview.style.display = 'none';
            imgPreview.src = '';
            videoPreview.src = '';

            const reader = new FileReader();
            reader.onload = function(e) {
                if (file.type.startsWith('video/')) {
                    videoPreview.src = e.target.result;
                    videoPreview.style.display = 'block';
                } else {
                    imgPreview.src = e.target.result;
                    imgPreview.style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
        }

        // Hiệu ứng loading khi submit
        document.getElementById('createStoryForm').addEventListener('submit', function() {
            const btn = document.getElementById('btnSubmit');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Uploading...';
        });
    </script>
}