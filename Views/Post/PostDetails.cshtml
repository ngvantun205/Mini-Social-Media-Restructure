@model PostViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Post Detail";
}

<div class="container" style="max-width: 800px; margin-top: 20px;">
    <div class="post-detail-card" style="background: white; border: 1px solid #dbdbdb; border-radius: 3px; display: flex; flex-wrap: wrap;">

        <div class="post-media-section" style="flex: 1 1 400px; background: black; display: flex; align-items: center; justify-content: center; min-height: 400px;">
            @if (Model.Medias != null && Model.Medias.Any()) {
                if (Model.Medias.Count() == 1) {
                    var media = Model.Medias.First();
                    if (media.MediaType == "video") {
                        <video controls style="max-width: 100%; max-height: 600px;"><source src="@media.Url" type="video/mp4" /></video>
                    }
                    else {
                        <img src="@media.Url" style="max-width: 100%; max-height: 600px; object-fit: contain;" />
                    }
                }
                else {
                    <div id="carouselDetail" class="carousel slide" data-bs-ride="carousel" style="width:100%">
                        <div class="carousel-inner">
                            @for (int i = 0; i < Model.Medias.Count(); i++) {
                                var media = Model.Medias.ElementAt(i);
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    @if (media.MediaType == "video") {
                                        <video controls class="d-block w-100" style="max-height: 600px;"><source src="@media.Url" type="video/mp4" /></video>
                                    }
                                    else {
                                        <img src="@media.Url" class="d-block w-100" style="max-height: 600px; object-fit: contain;" />
                                    }
                                </div>
                            }
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carouselDetail" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carouselDetail" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        </button>
                    </div>
                }
            }
            else {
                <div class="text-white">No Media</div>
            }
        </div>

        <div class="post-info-section" style="flex: 1 1 300px; padding: 15px; display: flex; flex-direction: column;">

            <div class="post-header d-flex align-items-center border-bottom pb-2">
                <img src="/images/avatar.png" width="32" height="32" class="rounded-circle me-2">
                <div>
                    <h6 class="m-0">@User.Identity.Name</h6>
                    @if (!string.IsNullOrEmpty(Model.Location)) {
                        <small class="text-muted">@Model.Location</small>
                    }
                </div>
                @if (Model.UserId == int.Parse(User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier).Value)) {
                    <div class="ms-auto">
                        <a asp-action="EditPost" asp-route-postId="@Model.PostId" class="btn btn-sm btn-link"><i class="bi bi-pencil"></i></a>
                        <button onclick="confirmDelete(@Model.PostId)" class="btn btn-sm btn-link text-danger"><i class="bi bi-trash"></i></button>
                    </div>
                }
            </div>

            <div class="comments-area flex-grow-1 py-2" style="overflow-y: auto; max-height: 400px;">
                <div class="caption mb-2">
                    <strong>@User.Identity.Name</strong> @Model.Caption
                    @if (!string.IsNullOrEmpty(Model.Hashtags)) {
                        <div class="mt-1">
                            @foreach (var tag in Model.Hashtags.Split(' ', StringSplitOptions.RemoveEmptyEntries)) {
                                var displayTag = tag.StartsWith("#") ? tag : "#" + tag;
                                <a href="#" style="color: #00376b; text-decoration: none; margin-right: 3px;">@displayTag</a>
                            }
                        </div>
                    }
                </div>
                <p class="text-muted"><small>No comments yet.</small></p>
            </div>

            <div class="actions border-top pt-2">
                <div class="d-flex justify-content-between mb-2">
                    <div>
                        <i class="bi bi-heart me-3 fs-4"></i>
                        <i class="bi bi-chat me-3 fs-4"></i>
                        <i class="bi bi-send fs-4"></i>
                    </div>
                    <i class="bi bi-bookmark fs-4"></i>
                </div>
                <p class="mb-1"><strong>@Model.LikeCount likes</strong></p>
                <small class="text-muted text-uppercase">@Model.CreatedAt.ToString("MMM dd, yyyy")</small>
            </div>

            <div class="add-comment border-top mt-2 pt-2 d-flex">
                <input type="text" class="form-control border-0" placeholder="Add a comment...">
                <button class="btn btn-link text-primary text-decoration-none fw-bold">Post</button>
            </div>
        </div>
    </div>
</div>

<form asp-action="DeletePost" method="post" id="deleteForm" style="display: none;">
    <input type="hidden" name="postId" id="deletePostId" value="@Model.PostId" />
</form>

@section Scripts {
    <script src="~/js/post-detail.js"></script>
}